<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Four Seasons Interactive Final</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #000;
            transition: background 1s ease;
            user-select: none; /* é˜²æ­¢é•¿æŒ‰é€‰ä¸­æ–‡æœ¬ */
            -webkit-user-select: none;
        }
        canvas {
            display: block;
        }
        #ui-layer {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
            display: flex;
            gap: 10px;
        }
        .season-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.4);
            color: white;
            padding: 8px 16px;
            cursor: pointer;
            border-radius: 20px;
            font-family: "Microsoft YaHei", sans-serif;
            font-size: 14px;
            backdrop-filter: blur(5px);
            transition: all 0.3s;
        }
        .season-btn:hover, .season-btn.active {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            transform: scale(1.1);
        }
        #instructions {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.7);
            font-family: sans-serif;
            font-size: 14px;
            pointer-events: none; 
            text-align: center;
            text-shadow: 0 0 5px rgba(0,0,0,0.5);
            z-index: 10;
        }
        /* æç¤ºç”¨æˆ·å¯ä»¥é•¿æŒ‰ */
        #hint {
            margin-top: 5px;
            font-size: 12px;
            opacity: 0.8;
            color: #ffd700;
        }
    </style>
</head>
<body>

    <div id="instructions">
        ç§»åŠ¨é¼ æ ‡æ§åˆ¶é£å‘ â€¢ <b>é•¿æŒ‰é¼ æ ‡/å±å¹•è§¦å‘å½©è›‹</b>
        <div id="hint">âœ¨ è¯•ç€æŒ‰ä½ä¸è¦æ¾æ‰‹ âœ¨</div>
    </div>

    <div id="ui-layer">
        <button class="season-btn active" onclick="setSeason('spring')">ğŸŒ¸ æ˜¥</button>
        <button class="season-btn" onclick="setSeason('summer')">ğŸŒ§ï¸ å¤</button>
        <button class="season-btn" onclick="setSeason('autumn')">ğŸ ç§‹</button>
        <button class="season-btn" onclick="setSeason('winter')">â„ï¸ å†¬</button>
    </div>

    <canvas id="canvas"></canvas>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let width, height;
        let particles = [];
        let debris = []; 
        let stars = []; 
        let flowers = []; 
        let tick = 0;
        
        let currentSeason = 'spring';
        // å½©è›‹çŠ¶æ€ï¼šæ˜¯å¦æ˜¾ç¤ºå›´å·¾
        let isScarfMode = false;
        
        const seasonConfig = {
            spring: {
                bgColor: ['#87CEEB', '#E0F7FA'], 
                particleCount: 800,
                groundColor: ['#4CAF50', '#8BC34A'],
                treeColor: ['#ffb7c5', '#ff9eb5'], 
                msg: "åˆ«æ€•ï¼ŒèŠ±å†å¤šæœ‰æˆ‘å‘¢"
            },
            summer: {
                bgColor: ['#2c3e50', '#34495e'], 
                particleCount: 1500,
                groundColor: ['#1b5e20', '#2e7d32'], 
                treeColor: ['#1b5e20', '#388E3C'], 
                msg: "åˆ«æ€•ï¼Œé›¨å†å¤§æœ‰æˆ‘å‘¢"
            },
            autumn: {
                bgColor: ['#5D4037', '#8D6E63'], 
                particleCount: 500, // æ«å¶ä¸éœ€è¦å¤ªå¤šï¼Œæ³¨é‡å½¢æ€
                groundColor: ['#6D4C41', '#8D6E63'], 
                treeColor: ['#bf360c', '#ff5722'], // æ›´çº¢çš„æ«æ ‘
                msg: "åˆ«æ€•ï¼Œé£å†å¤§æœ‰æˆ‘å‘¢"
            },
            winter: {
                bgColor: ['#0c1445', '#1c2b5a'], 
                particleCount: 1200,
                groundColor: ['#e0e5ff', '#cdd7f0'], 
                treeColor: ['#2e7d32', '#1b5e20'], 
                msg: "åˆ«æ€•ï¼Œé›ªå†å¤§æœ‰æˆ‘å‘¢"
            }
        };

        const mouse = { x: -1000, y: -1000, active: false };
        let wind = 0;

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
            initStaticElements();
        }

        function initStaticElements() {
            stars = [];
            for(let i=0; i<200; i++) {
                stars.push({
                    x: Math.random() * width,
                    y: Math.random() * height * 0.6,
                    size: Math.random() * 1.5 + 0.5,
                    opacity: Math.random()
                });
            }
            flowers = [];
            const cx = width / 2;
            for(let i=0; i<50; i++) {
                const angle = Math.random() * Math.PI; 
                const dist = Math.random() * width * 0.4;
                flowers.push({
                    x: cx + Math.cos(angle) * dist,
                    y: height - Math.random() * 100 + Math.sin(angle) * 20, 
                    color: `hsl(${Math.random() * 360}, 70%, 60%)`,
                    size: Math.random() * 3 + 2
                });
            }
        }

        window.setSeason = function(season) {
            currentSeason = season;
            document.querySelectorAll('.season-btn').forEach(btn => {
                if(btn.innerText.includes(season === 'spring' ? 'æ˜¥' : season === 'summer' ? 'å¤' : season === 'autumn' ? 'ç§‹' : 'å†¬')) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            particles = [];
            debris = [];
            const count = seasonConfig[season].particleCount;
            for(let i=0; i<count; i++) {
                particles.push(new Particle());
            }
        };

        class Particle {
            constructor() {
                this.reset(true);
            }

            reset(initial = false) {
                this.x = Math.random() * width;
                this.y = initial ? Math.random() * height : -50;
                this.z = Math.random(); 
                
                this.velX = 0;
                this.velY = 0;
                this.rotation = Math.random() * Math.PI * 2;
                this.spinSpeed = (Math.random() - 0.5) * 0.1;

                if (currentSeason === 'spring') {
                    this.size = 3 + this.z * 5;
                    this.speed = 1 + this.z * 1.5;
                    this.swingBase = Math.random() * Math.PI * 2;
                    const springColors = ['#ffb7c5', '#ffcdd2', '#e1bee7', '#b39ddb', '#bbdefb', '#fff9c4'];
                    this.color = springColors[Math.floor(Math.random() * springColors.length)];
                    this.opacity = 0.6 + this.z * 0.4;
                } 
                else if (currentSeason === 'summer') {
                    this.len = 15 + this.z * 20;
                    this.speed = 15 + this.z * 20;
                    this.color = `rgba(174, 194, 224, ${0.3 + this.z * 0.4})`;
                }
                else if (currentSeason === 'autumn') {
                    // ç§‹å¤©ä¿®æ”¹ï¼šæ›´å¤§ã€æ›´æ…¢ã€æ—‹è½¬æ›´æ˜æ˜¾
                    this.size = 6 + this.z * 8; // æ›´å¤§çš„æ«å¶
                    this.speed = 0.5 + this.z * 1.2; // ç¼“æ…¢é£˜è½
                    this.swingBase = Math.random() * Math.PI * 2;
                    this.spinSpeed = (Math.random() - 0.5) * 0.05; // ç¼“æ…¢æ—‹è½¬
                    const colors = ['#bf360c', '#d84315', '#e64a19', '#f57c00', '#ffb74d', '#8d6e63'];
                    this.color = colors[Math.floor(Math.random() * colors.length)];
                }
                else { 
                    this.size = 2 + this.z * 4;
                    this.speed = 1.5 + this.z * 2;
                    this.swingBase = Math.random() * Math.PI * 2;
                    this.color = `rgba(255, 255, 255, ${0.5 + this.z * 0.5})`;
                }
            }

            update() {
                const windTarget = (mouse.x - width / 2) * 0.02;
                wind += (windTarget - wind) * 0.01;
                
                if (currentSeason === 'summer') {
                    this.x += wind * this.z + (Math.random()-0.5);
                    this.y += this.speed;
                } else if (currentSeason === 'autumn') {
                    // ç§‹å¶é£˜è¡æ„Ÿæ›´å¼º
                    const swing = Math.sin(tick * 0.015 + this.swingBase) * (this.z * 3 + 1);
                    this.x += wind * this.z + swing;
                    this.y += this.speed;
                    this.rotation += this.spinSpeed;
                } else {
                    const swing = Math.sin(tick * 0.02 + this.swingBase) * (this.z * 2);
                    this.x += wind * this.z + swing;
                    this.y += this.speed;
                    this.rotation += this.spinSpeed;
                }

                // äº¤äº’åŠ›åœº (åªåœ¨éå½©è›‹æ¨¡å¼ä¸‹ç”Ÿæ•ˆï¼Œå½©è›‹æ¨¡å¼ä¸‹å›´å·¾ä¸æŒ¡é›¨)
                if (mouse.active && !isScarfMode) {
                    const dx = this.x - mouse.x;
                    const dy = this.y - mouse.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    const forceRadius = 130;

                    if (dist < forceRadius) {
                        const force = (forceRadius - dist) / forceRadius;
                        const angle = Math.atan2(dy, dx);
                        const pushStrength = currentSeason === 'summer' ? 20 : 10; 
                        this.x += Math.cos(angle) * force * pushStrength;
                        this.y += Math.sin(angle) * force * pushStrength;
                    }
                }

                if (this.y > height || this.x > width + 100 || this.x < -100) {
                    if (this.y > height && currentSeason === 'summer' && this.z > 0.5 && Math.random() > 0.7) {
                        debris.push(new Splash(this.x, height));
                    }
                    this.reset();
                    if (this.x > width) this.x = -50;
                    else if (this.x < 0) this.x = width + 50;
                }
            }

            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                
                if (currentSeason === 'spring') {
                    ctx.rotate(this.rotation);
                    ctx.beginPath();
                    ctx.ellipse(0, 0, this.size, this.size * 0.6, 0, 0, Math.PI*2);
                    ctx.fillStyle = this.color;
                    ctx.globalAlpha = this.opacity;
                    ctx.fill();
                } 
                else if (currentSeason === 'summer') {
                    ctx.rotate(wind * 0.05);
                    ctx.beginPath();
                    ctx.moveTo(0, 0);
                    ctx.lineTo(0, this.len);
                    ctx.strokeStyle = this.color;
                    ctx.lineWidth = 1.5 + this.z;
                    ctx.stroke();
                }
                else if (currentSeason === 'autumn') {
                    // === ç»˜åˆ¶ç²¾ç»†çš„äº”è§’æ«å¶ ===
                    ctx.rotate(this.rotation);
                    ctx.beginPath();
                    const s = this.size;
                    // æ¨¡æ‹Ÿæ«å¶çš„äº”ä¸ªå°–è§’
                    ctx.moveTo(0, -s); // é¡¶è§’
                    ctx.lineTo(s*0.25, -s*0.25); // å‡¹é™·
                    ctx.lineTo(s*0.9, -s*0.4); // å³ä¸Šè§’
                    ctx.lineTo(s*0.4, 0); // å‡¹é™·
                    ctx.lineTo(s*0.8, s*0.6); // å³ä¸‹è§’
                    ctx.lineTo(0, s*0.3); // åº•éƒ¨æ ¹èŒå¤„
                    ctx.lineTo(-s*0.8, s*0.6); // å·¦ä¸‹è§’
                    ctx.lineTo(-s*0.4, 0); // å‡¹é™·
                    ctx.lineTo(-s*0.9, -s*0.4); // å·¦ä¸Šè§’
                    ctx.lineTo(-s*0.25, -s*0.25); // å‡¹é™·
                    ctx.closePath();
                    
                    ctx.fillStyle = this.color;
                    ctx.fill();
                    // ç®€å•çš„å¶è„‰
                    ctx.strokeStyle = "rgba(0,0,0,0.15)";
                    ctx.lineWidth = 0.5;
                    ctx.beginPath();
                    ctx.moveTo(0, s*0.3); ctx.lineTo(0, -s*0.8);
                    ctx.moveTo(0, s*0.3); ctx.lineTo(s*0.7, -s*0.3);
                    ctx.moveTo(0, s*0.3); ctx.lineTo(-s*0.7, -s*0.3);
                    ctx.stroke();
                }
                else { 
                    if (this.z > 0.6) {
                        ctx.rotate(this.rotation);
                        ctx.beginPath();
                        ctx.strokeStyle = this.color;
                        ctx.lineWidth = 2;
                        ctx.lineCap = 'round';
                        for(let i=0; i<3; i++) {
                            ctx.moveTo(0, -this.size);
                            ctx.lineTo(0, this.size);
                            ctx.rotate(Math.PI/3);
                        }
                        ctx.stroke();
                        if (this.z > 0.8) {
                            ctx.shadowColor = "white";
                            ctx.shadowBlur = 5;
                            ctx.stroke();
                            ctx.shadowBlur = 0;
                        }
                    } else {
                        ctx.beginPath();
                        ctx.arc(0, 0, this.size * 0.6, 0, Math.PI*2);
                        ctx.fillStyle = this.color;
                        ctx.fill();
                    }
                }
                ctx.restore();
            }
        }

        class Splash {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 4;
                this.vy = -(Math.random() * 3 + 2);
                this.life = 1.0;
            }
            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vy += 0.2; 
                this.life -= 0.05;
            }
            draw() {
                ctx.fillStyle = `rgba(174, 194, 224, ${this.life})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, 1.5, 0, Math.PI*2);
                ctx.fill();
            }
        }

        function drawSkyElements(cx, cy) {
            ctx.save();
            if (currentSeason === 'spring') {
                const sunX = width * 0.8;
                const sunY = height * 0.2;
                const sunRadius = 60;
                ctx.beginPath();
                ctx.arc(sunX, sunY, sunRadius, 0, Math.PI * 2);
                const sunGrad = ctx.createRadialGradient(sunX, sunY, 0, sunX, sunY, sunRadius * 1.5);
                sunGrad.addColorStop(0, '#FFF176');
                sunGrad.addColorStop(0.6, '#FFD54F');
                sunGrad.addColorStop(1, 'rgba(255, 213, 79, 0)');
                ctx.fillStyle = sunGrad;
                ctx.fill();
            } else if (currentSeason === 'summer') {
                ctx.fillStyle = '#2c3e50';
                for(let i=0; i<5; i++) {
                    ctx.beginPath();
                    ctx.arc(width * 0.3 + i * 150, height * 0.1 + Math.sin(tick*0.01 + i)*20, 100, 0, Math.PI*2);
                    ctx.fill();
                     ctx.beginPath();
                    ctx.arc(width * 0.4 + i * 150, height * 0.15 + Math.cos(tick*0.01 + i)*20, 80, 0, Math.PI*2);
                    ctx.fill();
                }
            } else if (currentSeason === 'winter') {
                ctx.fillStyle = 'white';
                stars.forEach(star => {
                    ctx.globalAlpha = star.opacity * (0.5 + Math.sin(tick * 0.05 + star.x) * 0.5);
                    ctx.beginPath();
                    ctx.arc(star.x, star.y, star.size, 0, Math.PI*2);
                    ctx.fill();
                });
                ctx.globalAlpha = 1;

                const moonX = width * 0.85;
                const moonY = height * 0.2;
                const moonRadius = 50;
                ctx.beginPath();
                ctx.arc(moonX, moonY, moonRadius, 0, Math.PI*2);
                ctx.fillStyle = '#fffde7';
                ctx.shadowColor = '#fffde7';
                ctx.shadowBlur = 30;
                ctx.fill();
                ctx.shadowBlur = 0;
            }
            ctx.restore();
        }

        function drawScene() {
            const cx = width / 2;
            const bottomY = height;
            const config = seasonConfig[currentSeason];

            drawSkyElements(cx, bottomY);

            ctx.save();
            const gGrad = ctx.createLinearGradient(0, height - 150, 0, height);
            gGrad.addColorStop(0, config.groundColor[0]);
            gGrad.addColorStop(1, config.groundColor[1]);
            ctx.fillStyle = gGrad;
            
            ctx.beginPath();
            ctx.ellipse(cx, height + 100, width * 0.8, 200, 0, 0, Math.PI*2);
            ctx.fill();

            if (currentSeason === 'spring') {
                flowers.forEach(flower => {
                    ctx.beginPath();
                    ctx.arc(flower.x, flower.y, flower.size, 0, Math.PI*2);
                    ctx.fillStyle = flower.color;
                    ctx.fill();
                });
            } else if (currentSeason === 'autumn') {
                // åœ°é¢è£…é¥°æ”¹ä¸ºå‡ ä¸ªé™æ€çš„å¤§æ«å¶
                ctx.fillStyle = '#bf360c';
                for(let i=0; i<8; i++) {
                   ctx.save();
                   // éšæœºåˆ†å¸ƒåœ¨æ ‘ä¸‹
                   ctx.translate(cx - 100 + i*30 + Math.sin(i*123)*40, height - 20 + Math.cos(i*321)*10);
                   ctx.rotate(i);
                   const s = 4;
                   ctx.beginPath();
                   ctx.moveTo(0, -s); 
                   ctx.lineTo(s*0.25, -s*0.25); ctx.lineTo(s*0.9, -s*0.4); ctx.lineTo(s*0.4, 0); 
                   ctx.lineTo(s*0.8, s*0.6); ctx.lineTo(0, s*0.3); ctx.lineTo(-s*0.8, s*0.6); 
                   ctx.lineTo(-s*0.4, 0); ctx.lineTo(-s*0.9, -s*0.4); ctx.lineTo(-s*0.25, -s*0.25); 
                   ctx.fill();
                   ctx.restore();
                }
            }
            ctx.restore();

            const treeX = cx - 50;
            const treeBaseY = bottomY - 25;
            
            ctx.fillStyle = "#4e342e";
            ctx.fillRect(treeX - 15, treeBaseY - 60, 30, 60);

            const drawLayer = (y, w, h) => {
                ctx.beginPath();
                ctx.moveTo(treeX - w, y);
                ctx.lineTo(treeX + w, y);
                ctx.lineTo(treeX, y - h);
                ctx.closePath();
                
                const lGrad = ctx.createLinearGradient(treeX, y-h, treeX, y);
                lGrad.addColorStop(0, config.treeColor[0]);
                lGrad.addColorStop(1, config.treeColor[1]);
                ctx.fillStyle = lGrad;
                ctx.fill();
                
                if (currentSeason === 'winter') {
                     ctx.beginPath();
                     ctx.moveTo(treeX, y - h);
                     ctx.lineTo(treeX + w/2, y - h * 0.6);
                     ctx.lineTo(treeX - w/2, y - h * 0.6);
                     ctx.fillStyle = "rgba(255,255,255,0.9)";
                     ctx.fill();
                }
            };

            drawLayer(treeBaseY - 50, 80, 100);
            drawLayer(treeBaseY - 100, 60, 80);
            drawLayer(treeBaseY - 150, 40, 60);

            if (currentSeason === 'winter') {
                const smX = cx + 120;
                const smY = bottomY - 35;
                ctx.fillStyle = "#fff";
                ctx.beginPath(); ctx.arc(smX, smY - 30, 30, 0, Math.PI*2); ctx.fill();
                ctx.beginPath(); ctx.arc(smX, smY - 70, 20, 0, Math.PI*2); ctx.fill();
                ctx.fillStyle = "#333";
                ctx.beginPath(); ctx.arc(smX - 7, smY - 75, 2, 0, Math.PI*2); ctx.fill();
                ctx.beginPath(); ctx.arc(smX + 7, smY - 75, 2, 0, Math.PI*2); ctx.fill();
                ctx.beginPath(); ctx.arc(smX, smY - 30, 2, 0, Math.PI*2); ctx.fill();
                ctx.beginPath(); ctx.arc(smX, smY - 45, 2, 0, Math.PI*2); ctx.fill();
                ctx.fillStyle = "orange";
                ctx.beginPath(); ctx.moveTo(smX, smY - 72); ctx.lineTo(smX+10, smY-70); ctx.lineTo(smX, smY-68); ctx.fill();
            }
            
            if (currentSeason === 'summer') {
                for(let i=0; i<5; i++) {
                    const fx = cx + Math.sin(tick * 0.05 + i) * 150;
                    const fy = bottomY - 100 + Math.cos(tick * 0.03 + i) * 50;
                    const alpha = 0.5 + Math.sin(tick * 0.1 + i) * 0.5;
                    ctx.fillStyle = `rgba(200, 255, 100, ${alpha})`;
                    ctx.shadowColor = "rgb(200, 255, 100)";
                    ctx.shadowBlur = 10;
                    ctx.beginPath(); ctx.arc(fx, fy, 2, 0, Math.PI*2); ctx.fill();
                    ctx.shadowBlur = 0;
                }
            }
        }

        function drawInteraction() {
            if (!mouse.active) return;

            ctx.save();
            ctx.translate(mouse.x, mouse.y);
            
            if (isScarfMode) {
                // === å½©è›‹æ¨¡å¼ï¼šçº¢å›´å·¾ ===
                // ç»˜åˆ¶å›´å·¾ä¸»ä½“ (éšé£é£˜åŠ¨)
                const t = tick * 0.1;
                ctx.beginPath();
                // å›´å·¾ç»•åœˆéƒ¨åˆ†
                ctx.ellipse(0, 0, 25, 15, 0, 0, Math.PI*2);
                ctx.fillStyle = "#d32f2f";
                ctx.shadowColor = "rgba(255, 0, 0, 0.5)";
                ctx.shadowBlur = 15;
                ctx.fill();
                
                // é£˜åŠ¨çš„å°¾å·´
                ctx.beginPath();
                ctx.moveTo(10, 5);
                // è´å¡å°”æ›²çº¿æ¨¡æ‹Ÿé£˜åŠ¨
                ctx.bezierCurveTo(30, 20 + Math.sin(t)*10, 50, -10 + Math.cos(t)*10, 80 + Math.sin(t)*5, 10);
                ctx.lineTo(80 + Math.sin(t)*5, 25);
                ctx.bezierCurveTo(50, 5 + Math.cos(t)*10, 30, 35 + Math.sin(t)*10, 0, 15);
                ctx.fillStyle = "#e53935";
                ctx.fill();
                
                // ç¬¬äºŒæ¡å°¾å·´
                ctx.beginPath();
                ctx.moveTo(5, 5);
                ctx.bezierCurveTo(25, 30 + Math.cos(t)*8, 45, 10 + Math.sin(t)*8, 70 + Math.cos(t)*5, 30);
                ctx.lineTo(70 + Math.cos(t)*5, 45);
                ctx.bezierCurveTo(45, 25 + Math.sin(t)*8, 25, 45 + Math.cos(t)*8, -5, 15);
                ctx.fillStyle = "#c62828";
                ctx.fill();

                // ä¸“å±æ–‡æ¡ˆ
                ctx.shadowColor = "rgba(0,0,0,0.8)"; 
                ctx.shadowBlur = 4;
                ctx.font = "bold 18px 'Microsoft YaHei', sans-serif";
                ctx.fillStyle = "#ffffff";
                ctx.textAlign = "center";
                ctx.fillText("æˆ‘æƒ³é™ªä½ å››å­£æµè½¬", 0, -50);

            } else {
                // === æ™®é€šæ¨¡å¼ï¼šä¼ ===
                // ä¼ç›–
                ctx.beginPath();
                ctx.arc(0, -10, 45, Math.PI, 0); 
                ctx.bezierCurveTo(20, -25, -20, -25, -45, -10);
                
                let umbrellaColor = "rgba(30, 30, 40, 0.8)";
                let glowColor = "rgba(255, 255, 255, 0.5)";
                if (currentSeason === 'spring') glowColor = "rgba(255, 200, 220, 0.6)";
                if (currentSeason === 'autumn') glowColor = "rgba(255, 200, 100, 0.6)";
                if (currentSeason === 'winter') glowColor = "rgba(200, 220, 255, 0.6)";

                ctx.shadowColor = glowColor;
                ctx.shadowBlur = 25;
                ctx.fillStyle = umbrellaColor;
                ctx.fill();
                ctx.strokeStyle = "rgba(255, 255, 255, 0.8)";
                ctx.lineWidth = 2;
                ctx.stroke();

                // ä¼æŸ„
                ctx.beginPath();
                ctx.shadowBlur = 0; 
                ctx.moveTo(0, -20); ctx.lineTo(0, 35); ctx.arc(6, 35, 6, Math.PI, 0); 
                ctx.strokeStyle = "rgba(200, 200, 200, 0.8)";
                ctx.lineWidth = 3;
                ctx.stroke();

                // æ™®é€šæ–‡å­—
                ctx.shadowColor = "rgba(0,0,0,0.8)"; 
                ctx.shadowBlur = 4;
                ctx.font = "bold 16px 'Microsoft YaHei', sans-serif";
                ctx.fillStyle = "#ffffff";
                ctx.textAlign = "center";
                ctx.fillText(seasonConfig[currentSeason].msg, 0, -65);
            }
            
            ctx.restore();
        }

        function animate() {
            tick++;
            
            const bgConfig = seasonConfig[currentSeason].bgColor;
            const bgGrad = ctx.createLinearGradient(0, 0, 0, height);
            bgGrad.addColorStop(0, bgConfig[0]);
            bgGrad.addColorStop(1, bgConfig[1]);
            ctx.fillStyle = bgGrad;
            ctx.fillRect(0, 0, width, height);

            drawScene();

            for (let p of particles) {
                p.update();
                p.draw();
            }

            for (let i = debris.length - 1; i >= 0; i--) {
                debris[i].update();
                debris[i].draw();
                if (debris[i].life <= 0) debris.splice(i, 1);
            }
            if(debris.length > 200) debris.splice(0, 50);

            drawInteraction();

            requestAnimationFrame(animate);
        }

        window.addEventListener('resize', resize);
        
        // é¼ æ ‡ç§»åŠ¨
        window.addEventListener('mousemove', e => {
            mouse.x = e.clientX;
            mouse.y = e.clientY;
            mouse.active = true;
        });

        // è§¦æ‘¸ç§»åŠ¨
        window.addEventListener('touchmove', e => {
            e.preventDefault();
            mouse.x = e.touches[0].clientX;
            mouse.y = e.touches[0].clientY;
            mouse.active = true;
        }, {passive: false});

        // é¼ æ ‡/æ‰‹æŒ‡ ç¦»å¼€
        const endAction = () => {
            mouse.active = false;
            isScarfMode = false; // æŠ¬èµ·æ—¶å–æ¶ˆå›´å·¾æ¨¡å¼
        };
        window.addEventListener('touchend', endAction);
        window.addEventListener('mouseup', endAction);
        window.addEventListener('mouseleave', endAction);

        // é¼ æ ‡æŒ‰ä¸‹/æ‰‹æŒ‡æŒ‰ä¸‹ -> æ¿€æ´»å½©è›‹
        const startAction = (e) => {
             // å¦‚æœç‚¹å‡»çš„æ˜¯æŒ‰é’®ï¼Œä¸è§¦å‘å½©è›‹é€»è¾‘
             if (e.target.classList.contains('season-btn')) return;
             isScarfMode = true;
             
             // æ›´æ–°åæ ‡é˜²æ­¢æ²¡ç§»åŠ¨æ—¶åæ ‡ä¸å‡†
             if(e.touches) {
                 mouse.x = e.touches[0].clientX;
                 mouse.y = e.touches[0].clientY;
             } else {
                 mouse.x = e.clientX;
                 mouse.y = e.clientY;
             }
             mouse.active = true;
        };
        window.addEventListener('mousedown', startAction);
        window.addEventListener('touchstart', startAction, {passive: false});

        // åˆå§‹åŒ–
        resize();
        setSeason('spring'); 
        animate();

    </script>
</body>
</html>
